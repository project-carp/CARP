apply plugin: "spring-boot"
apply plugin: 'com.moowork.node'
apply plugin: "application"

buildscript {

    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }

    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath("org.springframework:springloaded:${springLoadedVersion}")
        classpath "com.moowork.gradle:gradle-node-plugin:0.12"
    }

}

dependencies {
    compile project(":carp-common")
    compile project(":carp-api")

    compile("org.springframework.boot:spring-boot-starter-web:${springBootVersion}")
    compile("org.springframework.boot:spring-boot-starter-actuator:${springBootVersion}")

    compile("org.springframework:spring-context:${springVersion}")
    compile("org.springframework:spring-context-support:${springVersion}")

    testCompile("org.springframework.boot:spring-boot-starter-test:${springBootVersion}")
}

bootRun {
    dependsOn("npmInstall")
    dependsOn("tsc")
    systemProperties = System.properties

    main = 'pl.carp.webapp.CarpApplication'
}

node {
    nodeModulesDir = file("src/main/resources/static/")
}

task tscw(type: NpmTask) {
    args = ['run', 'tscw']
    workingDir = file("src/main/resources/static/")
}

task tsc(type: NpmTask) {
    args = ['run', 'tsc']
    workingDir = file("src/main/resources/static/")
}

task runFrontend(dependsOn: [npmInstall, tscw]) {}